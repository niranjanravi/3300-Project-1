<html>

	<head>
		<title>Rap Visuals</title>

		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="http://d3js.org/topojson.v2.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

	</head>


	<body>

		<svg height="600" width="1000" id="svg1">

		</svg>

		<br>

		<svg height="300" width="1000" id="svg2">

		</svg>

		<script>

		var faces = ["fetty-wap.png","wayne.png","2-chainz.png","50.png","desiigner.png","kanye.png","future.png","keef.png", "drake.png","gucci.png"];

		var svg = d3.select("#svg1");
		var fileData;


		var nameFreq = [];

		var rapperData =
		[
			{name: "fetty_wap" , songs: 31, sales: 0.3},
			{name: "lil_wayne" , songs: 258, sales: 13.4},
			{name: "2_chainz" , songs: 102, sales: 0.9},
			{name: "50_cent" , songs: 186, sales: 15.7},
			{name: "desiigner" , songs: 12, sales: .02},
			{name: "kanye" , songs: 219, sales: 13.5},
			{name: "future" ,songs: 104, sales: 0.8},
			{name: "chief_keef" ,songs: 50, sales: 0.2},
			{name: "drake" ,songs: 153, sales: 7.4},
			{name: "gucci_mane" ,songs: 120, sales: 1.1}
		];

		//converts "fetty_wap" to "Fetty Wap"
		function capitalize_each_word(file_name){
			var words = file_name.split("_");
			words.forEach(function(word, index){
				words[index] = word[0].toLocaleUpperCase() + word.substring(1);
			});

			return words.join(" ");
		}


		d3.json("rappers.json",function(data){
			console.log("JSON data loaded");
			fileData = data;
			rapperData.forEach(function(rapper){
				rapper.count = fileData[rapper.name].count;
				rapper.totalwords = fileData[rapper.name].totalwords;

				var freq = rapper.totalwords/rapper.count;
				nameFreq.push({'name' : rapper.name ,'freq' : freq});
			});
			console.log(nameFreq);
			console.log("file data completely loaded");

			var songExtent = d3.extent(rapperData, function(d){ return d.songs; });
			var saleExtent = d3.extent(rapperData, function(d){ return d.sales; });
			var countExtent = d3.extent(rapperData, function(d){ return d.count/d.totalwords; });

			var songScale = d3.scaleLinear().domain([0, songExtent[1]]).range([20, svg.attr("width") - 20]);
			var saleScale = d3.scaleSqrt().domain([0, saleExtent[1]]).range([svg.attr("height") - 20, 20]);
			var countScale = d3.scaleLinear().domain(countExtent).range([15,50]);

			var songAxis = d3.axisBottom(songScale);
			var saleAxis = d3.axisLeft(saleScale);

			var plot = svg.append("g");
			plot.append("g").attr("transform","translate(0," + (svg.attr("height") - 20) +")").call(songAxis);
			plot.append("g").attr("transform","translate(20,0)").call(saleAxis);

			rapperData.forEach(function(rapper, i){

				svg.append('image')
				.attr("xlink:href", "facesbw/"+faces[i])
				.attr('x', songScale(rapper.songs))
				.attr('y', saleScale(rapper.sales))
				.attr('height', countScale(2*rapper.count/rapper.totalwords))
				.attr('width', countScale(2*rapper.count/rapper.totalwords));


				// var circle = svg.append("circle")
				// .attr("cx", songScale(rapper.songs))
				// .attr("cy", saleScale(rapper.sales))
				// .attr("r", countScale(rapper.count/rapper.totalwords));
				//.attr("fill", "url(#image"+i+")");

				/*svg.append("text")
				.attr("x", circle.attr("cx"))
				.attr("y", Number(circle.attr("cy")) + 2*Number(circle.attr("r")))
				.attr("text-anchor", "middle")
				.text(capitalize_each_word(rapper.name));*/


				//Second Graph

					});

			var svg2 = d3.select('#svg2');


			var freqExtent = d3.extent(nameFreq, function(d){return d.freq;});


			var frequencies = nameFreq.map(function(d) {return d});

			var xScale = d3.scaleLinear()
			.domain([0, freqExtent[1]])
			.range([0,500]);

			var yScale = d3.scaleLinear()
			.domain([10,0])
			.range([200, 10]);

			nameFreq.sort(function(a,b){
				return a.freq - b.freq;
			});

			var ticks = [];
			nameFreq.forEach(function(d){
				ticks.push(capitalize_each_word(d.name));
			});

			var xAxis = d3.axisBottom(xScale);
			var yAxis = d3.axisLeft(yScale)
			.tickFormat(function(d,i){
				return ticks[10 - i];
			});

			var plot2 = svg2.append("g").attr("transform", "translate(500, 50)");

			plot2.append("g").attr("transform", "translate(0, 200)").call(xAxis);
			// plot2.append("g").attr("transform", "translate(0, 0)").call(yAxis);

			nameFreq.forEach(function(d, i){
				plot2.append("line")
				.attr("x1", xScale(-d.freq))
				.attr("x2", xScale(d.freq))
				.attr("y1", yScale(i))
				.attr("y2", yScale(i))
				.attr("stroke", "black")
				.attr("stroke-width", 15);
				plot2.append("text")
				.attr("stroke", "white")
				.attr("font-size", 8)
				.attr("x",xScale(20))
				.attr("y",yScale(i))
				.text(capitalize_each_word(d.name).toLocaleUpperCase());
				plot2.append("text")
				.attr("stroke", "white")
				.attr("font-size", 8)
				.attr("text-anchor", "middle")
				.attr("x",xScale(- 50))
				.attr("y",yScale(i))
				.text(Math.round(d.freq));
			});
			plot2.append("line")
			.attr("x1", xScale(0))
			.attr("x2", xScale(0))
			.attr("y1", yScale(-1))
			.attr("y2", yScale(10))
			.attr("stroke", "white")
			.attr("stroke-width", 3);




	});


		</script>
	</body>
</html>
