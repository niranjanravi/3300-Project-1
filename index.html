<html>

	<head>
		<title>Rap Visuals</title>

		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="http://d3js.org/topojson.v2.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700i" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900i" rel="stylesheet">

	</head>


	<body>

		<style>

		*{
			padding: 0; /** normalize */
			margin:  0; /** normalize */
		}

		a{
			color: black;
		}

		h3,h4{
			font-weight: 400;
			margin-top: 10px;
			font-family: 'Open Sans', sans-serif;
		}

		svg{
			display: block;
			margin: 0 auto;
			border: 1px solid #D75C5D;
		}

		.header{
			padding-top: 150px;
			height: 450px;
			width: 100%;
			text-align: center;
		}

		.header h1{
			font-family: 'Playfair Display', serif;
			font-weight: 900;
			font-style: italic;
			font-size: 96px;
			margin-bottom: 20px;
		}

		.text{
			background-color: #F7F7F7;
			text-align: justify;;
			padding: 50px 0px 30px 0px;
		}

		.text p{
			width: 50%;
			margin: 0px auto 20px auto;
			font-size: 16px;
			font-family: 'Playfair Display', serif;
			line-height: 24px;
		}

		.viz{
			padding: 50px 0;
			background-color: #EAEAEA;
			font-family: 'Open Sans', sans-serif;
		}

		.footer{
			padding: 20px 0;
			font-family: 'Open Sans', sans-serif;
		}

		.footer p{
			color: #232323;
			font-size: 12px;
			font-weight: 600;
			text-align: center;
		}

		</style>

		<div class="header">

			<h1>
				Rap's <br>
				Largest Ego
			</h1>

			<h3>Just how much does Kanye love Kanye?</h3>

			<h4>By <a href="https://github.com/niranjanravi/3300-Project-1">Charles, Michael and Niranjan</a></h4>

		</div>

		<div class="text" id="t1">
			<p> For decades, rap has been about the ego;
		Lyrics have centered around money, fame, and other measures of success. (Write
some other stuff idk yet.) In popular culture, Kayne West is notorious for his
inflated ego. He has been quoted comparing himself to god, and his interruption
at the Grammy's was one of many examples of his "im better than you" worldview. </p>

			<p>It is obvious that kanye has an ego, but is he the only one? We decided
			to collected some data and decide once and for all who has the biggest ego
			in rap. We started by creating a corpus of lyrics from 10 of this years
			most popular rappers.</p>

</div>


		<div class="viz" id="v1">
			<svg height="600" width="1000" id="svg1"></svg>
		</div>

		<div class="text" id="t2">
			<p>The graph above shows some interesting facts.
		There is a nice linear trend between the amount of songs an artist has put
		out and the amount of money earned. This trend tells us that for the most
		part, and artist makes a consistent amount of money. For real I am not sure
		what to write in here, but we have time. I am mostly just trying to see how
		it will look one we actually fill it out with real text.</p>

		<p>
			The size of the heads corrospond to the "ego score" of each artist. This metric was determined by the amount of self-references found in the lyrics of each artist.
			We will be writing more about this, but again I am just trying to get a feel for how it looks with text so I can change the styling appropriately!!
		</p>
	</div>

		<div class="viz" id="v2">
			<svg height="500" width="1000" id="svg2"></svg>
		</div>

		<div class="text" id="t3">
			<p>some chill filler text</p>
			<p> ...</p>
		</div>

		<div class="footer">
			<p>A CS/INFO 3300 Project. Read the full PDF report <a href="#">here.</a></p>
		</div>

		<script>

		var faces = ["fetty-wap.png","wayne.png","2-chainz.png","502.png","desiigner.png","kanye.png","future.png","keef.png", "drake.png","gucci.png"];

		var svg = d3.select("#svg1");
		var fileData;


		var nameFreq = [];

		var rapperData =
		[
			{name: "fetty_wap" , songs: 31, sales: 0.3},
			{name: "lil_wayne" , songs: 258, sales: 13.4},
			{name: "2_chainz" , songs: 102, sales: 0.9},
			{name: "50_cent" , songs: 186, sales: 15.7},
			{name: "desiigner" , songs: 12, sales: .02},
			{name: "kanye" , songs: 219, sales: 13.5},
			{name: "future" ,songs: 104, sales: 0.8},
			{name: "chief_keef" ,songs: 50, sales: 0.2},
			{name: "drake" ,songs: 153, sales: 7.4},
			{name: "gucci_mane" ,songs: 120, sales: 1.1}
		];

		//converts "fetty_wap" to "Fetty Wap"
		function capitalize_each_word(file_name){
			var words = file_name.split("_");
			words.forEach(function(word, index){
				words[index] = word[0].toLocaleUpperCase() + word.substring(1);
			});

			return words.join(" ");
		}

		var egoScale;

		d3.json("rappers.json",function(data){

			console.log("JSON data loaded");
			fileData = data;

			rapperData.forEach(function(rapper){
				rapper.count = fileData[rapper.name].count;
				rapper.totalwords = fileData[rapper.name].totalwords;
				var freq = rapper.totalwords/rapper.count;
				nameFreq.push({'name' : rapper.name ,'freq' : freq});
			});

			var songExtent = d3.extent(rapperData, function(d){ return d.songs; });
			var saleExtent = d3.extent(rapperData, function(d){ return d.sales; });
			var countExtent = d3.extent(rapperData, function(d){ return d.count/d.totalwords; });

			var songScale = d3.scaleLinear()
			.domain([0, (songExtent[1] + .1 * songExtent[1]) ])
			.range([20, svg.attr("width") - 100]);

			var saleScale = d3.scaleSqrt()
			.domain([0, (saleExtent[1] + .2 * saleExtent[1])] )
			.range([svg.attr("height") - 50, 120]);

			var countScale = d3.scaleLinear()
			.domain(countExtent)
			.range([15,50]);

			var medianEgo = .00236;
			var kanyeEgo = .0102;

			egoScale = d3.scaleLinear()
			.domain([medianEgo,kanyeEgo])
			.range([1,5]);

			var songAxis = d3.axisBottom(songScale);
			var saleAxis = d3.axisLeft(saleScale);

			var plot = svg.append("g");
			plot.attr("transform","translate(50,-40)");
			plot.append("g").attr("transform","translate(-20, " + (svg.attr("height") - 50)  + ")" ).call(songAxis);
			plot.append("g").attr("transform","translate(0,0)").call(saleAxis);


			// is the sale in millions of dollars?
			svg.append('text')
			.attr("transform","translate(20," + (svg.attr("height") - 200) +")rotate(-90)")
			.text("Sales (Millions)");

			svg.append("text")
			.attr("transform","translate("+svg.attr("width")/2+"," + (svg.attr("height") -10) +")")
			.attr("text-anchor","middle")
			.text("Number of Singles (Lifetime)");

			rapperData.forEach(function(rapper, i){
				plot.append('image')
				.attr("xlink:href", "facesbw/"+faces[i])
				.attr('x', songScale(rapper.songs)-30)
				.attr('y', saleScale(rapper.sales)-30)
				.attr('height', 60)
				.attr('width', 60);

				plot.append("circle")
				.attr("cx", songScale(rapper.songs))
				.attr("cy", saleScale(rapper.sales))
				.attr("r",egoScale(rapper.count/rapper.totalwords)*30)
				.style("stroke-dasharray", ("3, 3"))
				.attr("fill", "none")
				.attr("stroke", "#D75C5D")
				.attr("stroke-opacity", 1)
				.attr("stroke-width", 2);

			});

			// for (var c = 2; c < 7; c=c+2){
			// 	plot.append("circle")
			// 	.attr("r",c*10)
			// 	.attr("cx",songScale(220))
			// 	.attr("cy",saleScale(3))
			// 	.attr("fill","none")
			// 	.attr("stroke", "black")
			// 	.attr("stroke-width",20)
			// 	.attr("stroke-opacity",.1*c);
			// }


			var svg2 = d3.select('#svg2');


			var freqExtent = d3.extent(nameFreq, function(d){return d.freq;});
			var frequencies = nameFreq.map(function(d) {return d});

			var xScale = d3.scaleLinear()
			.domain([0, freqExtent[1]])
			.range([0,500]);

			var yScale = d3.scaleLinear()
			.domain([10,0])
			.range([400, 10]);

			nameFreq.sort(function(a,b){
				return a.freq - b.freq;
			});

			var ticks = [];
			nameFreq.forEach(function(d){
				ticks.push(capitalize_each_word(d.name));
			});

			var xAxis = d3.axisBottom(xScale);
			var yAxis = d3.axisLeft(yScale)
			.tickFormat(function(d,i){
				return ticks[10 - i];
			});

			var plot2 = svg2.append("g").attr("transform", "translate(500, 50)");

			// plot2.append("g").attr("transform", "translate(0, 200)").call(xAxis);
			// plot2.append("g").attr("transform", "translate(0, 0)").call(yAxis);

			nameFreq.forEach(function(d, i){
				// plot2.append("line")
				// .attr("x1", xScale(-d.freq))
				// .attr("x2", xScale(d.freq))
				// .attr("y1", yScale(i))
				// .attr("y2", yScale(i))
				// .attr("stroke", "black")
				// .attr("stroke-width", 25);
				plot2.append("rect")
				.attr("height","30px")
				.attr("width",2*xScale(d.freq))
				.attr("stroke","black")
				.attr("fill", "black")
				.attr("fill-opacity","0.1")
				.attr("x",-xScale(d.freq))
				.attr("y",yScale(i)-20);
				// artists
				plot2.append("text")
				.attr("stroke", "black")
				.attr("font-size", 10)
				.attr("y",yScale(i))
				.attr("text-anchor","middle")
				.text(capitalize_each_word(d.name).toLocaleUpperCase() + " " + Math.round(d.freq));
				// numbers
				// plot2.append("text")
				// .attr("stroke", "white")
				// .attr("font-size", 10)
				// .attr("text-anchor", "middle")
				// .attr("x",xScale(- 50))
				// .attr("y",yScale(i))
				// .text(Math.round(d.freq));
			});
			// white divider line
			// plot2.append("line")
			// .attr("x1", 0)
			// .attr("x2", 0)
			// .attr("y1", yScale(-1))
			// .attr("y2", yScale(10))
			// .attr("stroke", "white")
			// .attr("stroke-width", 3);

			// yellow arrow
			// plot2.append("line")
			// .attr("x1", xScale(0))
			// .attr("x2", 470)
			// .attr("y1", yScale(10.2))
			// .attr("y2", yScale(10.2))
			// .attr("stroke", "gold")
			// .attr("stroke-width", 5);
			//
			// plot2.append("path")
			// .attr("d", "M 500, 305.8 L 460, 295.8 460, 315.8 500, 305.8 Z")
			// .attr("fill", "gold")
			// .attr("stroke", "gold");



	});


		</script>
	</body>
</html>
